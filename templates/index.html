<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jackpot 注資自動計算器 (v4)</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: #f4f7f6; color: #333; max-width: 800px; margin: 20px auto; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1, h2 { color: #2c3e50; text-align: center; }
        .container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px 30px; }
        .card { background-color: #ffffff; padding: 20px; border-radius: 8px; border: 1px solid #ddd; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        input[type="number"] { width: calc(100% - 20px); padding: 8px 10px; border-radius: 4px; border: 1px solid #ccc; margin-bottom: 15px; font-size: 1em; }
        .buttons { grid-column: 1 / -1; text-align: center; margin-top: 10px; }
        button { background-color: #3498db; color: white; border: none; padding: 12px 25px; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 0 10px; transition: background-color 0.3s; }
        button:hover { background-color: #2980b9; }
        button.secondary { background-color: #e74c3c; }
        button.secondary:hover { background-color: #c0392b; }
        .results { grid-column: 1 / -1; background-color: #e8f6f3; border: 1px solid #1abc9c; padding: 20px; border-radius: 8px; margin-top: 20px; }
        .results h3 { margin-top: 0; color: #16a085; text-align: center;}
        .results p { font-size: 1.2em; margin: 10px 0; line-height: 1.6; }
        .results span { font-weight: bold; color: #2c3e50; float: right; }
    </style>
</head>
<body>
    <h1>Jackpot 注資計算器</h1>
    <form method="POST">
        <div class="container">
            <div class="card">
                <h2>規則參數</h2>
                <label for="sub_pool_cap">副池累積上限金額 A (₱)</label>
                <input type="number" id="sub_pool_cap" name="sub_pool_cap" step="any" value="{{ values.sub_pool_cap if 'sub_pool_cap' in values else '' }}" placeholder="預設: 100000">

                <label for="main_pool_base">主池保底金額 (₱)</label>
                <input type="number" id="main_pool_base" name="main_pool_base" step="any" value="{{ values.main_pool_base if 'main_pool_base' in values else '' }}" placeholder="預設: 100000">

                <label for="total_contribution_rate">用戶注額抽水進 JP 比例 y (%)</label>
                <input type="number" id="total_contribution_rate" name="total_contribution_rate" step="any" value="{{ values.total_contribution_rate if 'total_contribution_rate' in values else '' }}" placeholder="預設: 0.5">

                <label for="main_pool_share_percentage">主池分配比例 X (%)</label>
                <input type="number" id="main_pool_share_percentage" name="main_pool_share_percentage" step="any" min="0" max="100" value="{{ values.main_pool_share_percentage if 'main_pool_share_percentage' in values else '' }}" placeholder="預設: 30">

                <label for="sub_pool_share_percentage">副池分配比例 z (%)</label>
                <input type="number" id="sub_pool_share_percentage" name="sub_pool_share_percentage" step="any" readonly style="background-color:#eee;">
            </div>
            <div class="card">
                <h2>當前狀態與投注</h2>
                <label for="sub_pool_current">當前副池餘額 (₱)</label>
                <input type="number" id="sub_pool_current" name="sub_pool_current" step="any" value="{{ values.sub_pool_current if 'sub_pool_current' in values else 0 }}" required>

                <label for="main_pool_current">當前主池餘額 (₱)</label>
                <input type="number" id="main_pool_current" name="main_pool_current" step="any" value="{{ values.main_pool_current if 'main_pool_current' in values else 0 }}" required>

                <label for="main_bet">玩家 Main Bet 押注額 (₱)</label>
                <input type="number" id="main_bet" name="main_bet" step="any" value="{{ values.main_bet if 'main_bet' in values else 0 }}" required>
            </div>

            {% if results %}
            <div class="results">
                <h3>{{ results.message }}</h3>
                {% if 'contribution_to_sub' in results %}
                <p>注入副池金額 (金額變化): <span>₱ {{ results.contribution_to_sub }}</span></p>
                <p>注入主池金額 (金額變化): <span>₱ {{ results.contribution_to_main }}</span></p>
                <hr>
                <p><b>投注後副池新餘額:</b> <span><b>₱ {{ results.new_sub_pool }}</b></span></p>
                <p><b>投注後主池新餘額:</b> <span><b>₱ {{ results.new_main_pool }}</b></span></p>
                {% endif %}
                {% if 'new_sub_pool_after_win' in results %}
                <p>從副池轉移金額: <span>₱ {{ results.transferred_amount }}</span></p>
                <hr>
                <p><b>副池轉移後新餘額:</b> <span><b>₱ {{ results.new_sub_pool_after_win }}</b></span></p>
                <p><b>主池重置後新餘額:</b> <span><b>₱ {{ results.new_main_pool_after_win }}</b></span></p>
                {% endif %}
            </div>
            {% endif %}

            <div class="buttons">
                <button type="submit" name="action" value="計算注資">計算注資</button>
                <button type="submit" name="action" value="模擬Jackpot開獎" class="secondary">模擬Jackpot開獎</button>
            </div>
        </div>
    </form>
    <script>
        const mainPoolShareInput = document.getElementById('main_pool_share_percentage');
        const subPoolShareInput = document.getElementById('sub_pool_share_percentage');

        function updateSubPoolShare() {
            let mainShare = parseFloat(mainPoolShareInput.value);
            if (isNaN(mainShare)) {
                const placeholderValue = mainPoolShareInput.placeholder.split(':')[1];
                mainShare = placeholderValue ? parseFloat(placeholderValue) : 30;
            }

            if (mainShare > 100) {
                mainPoolShareInput.value = 100;
                mainShare = 100;
            } else if (mainShare < 0) {
                mainPoolShareInput.value = 0;
                mainShare = 0;
            }

            const subShare = 100 - mainShare;
            subPoolShareInput.value = subShare.toFixed(2);
        }

        document.addEventListener('DOMContentLoaded', updateSubPoolShare);
        mainPoolShareInput.addEventListener('input', updateSubPoolShare);
    </script>
</body>
</html>